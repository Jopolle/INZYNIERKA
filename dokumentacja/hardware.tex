\section{Projekt części sprzętowej}

\label{sec:wymagania-sprzetowe-przeglad}
\subsection{Wymagania sprzętowe — przegląd}
\label{sec:wymagania-sprzetowe-przeglad}

Projektowana płytka stanowi jedną, spójną platformę do pomiaru i generacji sygnałów 0--10~V w aplikacjach HVAC, współpracującą z zestawem uruchomieniowym wyposażonym w m.in. MCU STM32F7 i panel TFT. Od strony zasilania przewidziano wejście instalacyjne DC z podstawowym torem ochronnym (odwrotna polaryzacja, przepięcia, wstępna filtracja), następnie podział zasilania na osobne gałęzie dla części cyfrowej, analogowej i elementów interfejsowych. Taki układ zmniejsza wpływ zakłóceń na pomiary i stabilizuje pracę torów. Interfejs do świata zewnętrznego obejmuje wejścia 0--10~V przygotowane do bezpiecznego próbkowania przez ADC (buforowanie i prosta filtracja antyaliasingowa) oraz wyjścia 0--10~V realizowane przez DAC i wzmacniacze operacyjne. Warstwa analogowa jest topologicznie oddzielona od cyfrowej (kontrolowane powroty prądowe, wydzielone obszary masy, filtry na przejściach między domenami), co ogranicza przesłuchy i dryft.


\subsection{Moduł zasilania}


Układ zasilania płytki został zaprojektowany tak, aby bezpiecznie przyjąć instalacyjne napięcie stałe (do ok.~24~V) i rozdzielić je na dwie stabilne linie: \mbox{+5~V} oraz \mbox{+3{,}3~V}. Na wejściu zastosowano gniazdo \textbf{J1} (DC~jack 5{,}5\,$\times$\,2{,}1~mm), za którym znajduje się polimerowy bezpiecznik samoresetujący \textbf{F1} (PPTC~1{,}1~A/30~V) pełniący rolę zabezpieczenia nadprądowego. Dodatkowo tranzystor \textbf{Q1} (PMOS \textit{IRLML9301}) realizuje ochronę przed odwrotną polaryzacją zasilania; rezystory \textbf{R5}/\textbf{R4} służą do wysterowania tranzystora.

Równolegle do toru wejściowego umieszczono diodę TVS \textbf{D3} (SMBJ33A) tłumiącą przepięcia oraz diodę \textbf{D4} (SOD323) do szybkiego klampowania krótkich impulsów. Włącznik \textbf{SW1} odcina cały moduł zasilania, a wskaźnik \textbf{D5} z rezystorem \textbf{R14} sygnalizuje obecność napięcia.

Za sekcją ochronną znajduje się wstępna filtracja: dławik \textbf{L3} (33~\textmu H) oraz kondensatory \textbf{C15} (100~\textmu F/63~V), \textbf{C26} (100~nF), \textbf{C27} (47~\textmu F) i \textbf{C16} (1~\textmu F) ograniczają wahania napięcia i szpilki prądowe ładujące przetwornice. Dodatkowy koralik ferrytowy \textbf{FB1} poprawia tłumienie zakłóceń o wyższych częstotliwościach.

Konwersję napięcia realizują dwie niezależne przetwornice buck z rodziny \textit{LM2596S}. Układ \textbf{U1} (\textit{LM2596S--5}) generuje linię \mbox{+5~V}; w jego torze znajdują się: dławik \textbf{L2} (33~\textmu H), dioda Schottky’ego \textbf{D1} (SK56) oraz kondensatory wejściowe \textbf{C2} (100~\textmu F/63~V) i \textbf{C1} (470~nF) oraz wyjściowe \textbf{C4}/\textbf{C3}. Analogicznie \textbf{U2} (\textit{LM2596S--3{,}3}) dostarcza \mbox{+3{,}3~V} z użyciem dławika \textbf{L1} (68~\textmu H), diody \textbf{D2} (SK56) oraz zestawu kondensatorów \textbf{C5}, \textbf{C6} po stronie wejściowej i \textbf{C7}, \textbf{C8} po stronie wyjściowej. Dobór elementów został wykonany w zgodności z zaleceniami producenta przetwornic. Wspólny punkt masy prowadzony jest od strony wejściowej, a rozdział linii \mbox{+5~V} i \mbox{+3{,}3~V} pozwala zasilać oddzielnie część cyfrową, analogową i interfejsową, co ogranicza przesłuchy i wrażliwość torów pomiarowych.

Stan szyn wyjściowych jest sygnalizowany diodami LED: \textbf{D7} (\mbox{+5~V}) z rezystorem \textbf{R16} oraz \textbf{D6} (\mbox{+3{,}3~V}) z rezystorem \textbf{R15}. Na schemacie umieszczono również znaczniki \texttt{PWR\_FLAG}, ułatwiające kontrolę ciągów zasilania w~narzędziu CADe. Całość tworzy spójny, tor: \emph{wejście i zabezpieczenia $\rightarrow$ filtracja wstępna $\rightarrow$ konwersja \mbox{+5~V}/\mbox{+3{,}3~V} $\rightarrow$ dystrybucja i sygnalizacja}, co przekłada się na stabilną pracę układu w warunkach typowych dla instalacji HVAC.


\subsection{Tor wyjściowy \texorpdfstring{0--10\,V}{0–10 V}: przetwornik DAC + wzmacniacze operacyjne}

Tor wyjściowy generujący sygnały \mbox{0--10~V} oparto na ośmiokanałowym przetworniku cyfrowo–analogowym \textbf{U3} (\textit{DAC7568IAPW}) współpracującym z dwoma czterokanałowymi wzmacniaczami operacyjnymi \textbf{U5} i \textbf{U6} (\textit{TLV9304xPW}). DAC zasilany jest z linii \mbox{+3{,}3~V}, a komunikację z STM32 discovery realizuje przez interfejs SPI wykluczając przewód \texttt{DOUT/MISO}. Wyprowadzenie \texttt{VREFIN/VREFOUT} służy do ustalenia napięcia referencyjnego, a wszystkie masy części analogowej prowadzone są do \texttt{GNDA} (\texttt{GND} ale po prostej filtracji dla czystego sygnału wyjściowego). Kondensator \textbf{C17} (\mbox{150~nF}) umieszczono możliwie blisko zgodnie z zaleceniami producenta przy używaniu wewnętrznego napięcia referencyjnego (TUTAJ CYTAT NOTY KATALOGOWEJ GAMONIU).

Każdy z ośmiu kanałów \texttt{VOUTA}--\texttt{VOUTH} jest dalej kształtowany przez prosty filtr dolnoprzepustowy RC na wejściu wzmacniacza: rezystor szeregowy (\textbf{R8}, \textbf{R9}, \textbf{R11}--\textbf{R13}, \textbf{R6}, \textbf{R7}, \textbf{R10}, \(3{,}3\,\mathrm{k}\Omega\)) oraz kondensator do masy (\textbf{C18}, \textbf{C21}--\textbf{C25}, \(1\,\mu\mathrm{F}\)). Wyznacza to częstotliwość odcięcia rzędu
\[
f_c \approx \frac{1}{2\pi R C} \approx \frac{1}{2\pi \cdot 3{,}3\ \mathrm{k}\Omega \cdot 1\ \mu\mathrm{F}} \approx 48\ \mathrm{Hz},
\]
co skutecznie powinno tłumić szum i poszarpanie przebiegu pochodzące z aktualizacji DAC, a jednocześnie jest wystarczająco szybkie dla aplikacji HVAC.

Wzmacniacze \textbf{U5A}--\textbf{U5D} oraz \textbf{U6A}--\textbf{U6D} pracują w konfiguracji nieodwracającej i są zasilane bezpośrednio z linii \mbox{+24~V}, co zapewnia odpowiedni zapas napięciowy dla wyjść \mbox{0--10~V}. Dla każdego kanału zastosowano identyczną sieć sprzężenia zwrotnego: rezystor do masy (\textbf{RG1}/\textbf{RG2}/\dots/\textbf{RG8}, \(10\,\mathrm{k}\Omega\)) oraz rezystor w pętli sprzężenia (\textbf{RF1}/\textbf{RF2}/\dots/\textbf{RF8}, \(30\,\mathrm{k}\Omega\)). Wzmocnienie napięciowe pojedynczego toru wynosi więc
\[
A_v = 1 + \frac{R_F}{R_G} = 1 + \frac{30\ \mathrm{k}\Omega}{10\ \mathrm{k}\Omega} = 4,
\]
co przy referencji DAC rzędu \mbox{2{,}5~V} pozwala uzyskać zakres \mbox{0--10~V} na wyjściu wzmacniacza. Dodatkowe kondensatory (\textbf{C19}, \textbf{C20}, \dots, \textbf{C23}, \(1\,\mu\mathrm{F}\)) pełnią funkcję lokalnej filtracji i wraz z impedancją obciążenia wygładzają sygnał na wyjściu, ograniczając szybkie skoki prądu podczas przełączeń.

Wyjścia poszczególnych wzmacniaczy są wyprowadzone na uniwersalne złącza \textbf{J6}--\textbf{J13}. Każde złącze udostępnia linię sygnałową \mbox{0--10~V}, odniesienie \texttt{SG} (\emph{signal ground}) oraz pin \texttt{SHIELD} przeznaczony do ekranowania przewodów.

Cały tor wyjściowy ma zatem strukturę:\newline \emph{STM32 $\rightarrow$ DAC $\rightarrow$ filtr RC  $\rightarrow$ wzmacniacz nieodwracający \texttt{x4} $\rightarrow$ złącze sygnałowe z ekranem}.
